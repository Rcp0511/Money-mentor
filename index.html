<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Money Mentor | Learning Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
<style>
:root {
    --bg: #f8fafc;
    --card-bg: #ffffff;
    --text: #1e293b;
    --text-light: #64748b;
    --primary: #10b981;
    --primary-hover: #059669;
    --secondary: #334155;
    --accent: #f59e0b;
    --danger: #ef4444;
    --glass: rgba(255, 255, 255, 0.9);
    --border: #e2e8f0;
}

[data-theme="dark"] {
    --bg: #0f172a;
    --card-bg: #1e293b;
    --text: #f1f5f9;
    --text-light: #94a3b8;
    --glass: rgba(15, 23, 42, 0.9);
    --border: #334155;
}

* { box-sizing: border-box; transition: background-color 0.3s, color 0.3s; }

body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background-color: var(--bg);
    background-image: radial-gradient(var(--border) 1px, transparent 1px);
    background-size: 20px 20px;
    color: var(--text);
    overflow-x: hidden;
}

/* Header */
header {
    background: linear-gradient(135deg, #059669, #065f46);
    color: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
}

.logo {
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    font-size: 1.25rem;
    letter-spacing: -0.5px;
}

.header-tools { display: flex; align-items: center; gap: 0.75rem; }

/* Buttons */
.btn {
    border: none;
    border-radius: 12px;
    padding: 0.6rem 1.2rem;
    font-weight: 600;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    transition: all 0.2s;
    text-decoration: none;
    position: relative;
}

.btn-primary { background: var(--primary); color: white; }
.btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
.btn-outline { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }
.btn-ghost { background: transparent; color: white; }
.btn-ghost:hover { background: rgba(255,255,255,0.1); }

/* Tooltip for disabled star button */
.btn-disabled-container {
    position: relative;
    display: inline-flex;
    flex: 1;
}

.tooltip-text {
    visibility: hidden;
    width: 180px;
    background-color: #334155;
    color: #fff;
    text-align: center;
    border-radius: 8px;
    padding: 8px;
    position: absolute;
    z-index: 10;
    bottom: 125%;
    left: 50%;
    margin-left: -90px;
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.75rem;
    pointer-events: none;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}

.btn-disabled-container:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

/* Dashboard Layout */
.container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }
.unit-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
.unit-card {
    background: var(--card-bg);
    border-radius: 24px;
    border: 1px solid var(--border);
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    cursor: pointer;
    position: relative;
}
.unit-card-hero {
    padding: 2.5rem;
    background: linear-gradient(135deg, #10b981 0%, #065f46 100%);
    color: white;
    position: relative;
    overflow: hidden;
}

.unit-card-hero::after {
    content: "";
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background-image: repeating-linear-gradient(
        -45deg,
        transparent,
        transparent 15px,
        rgba(255, 255, 255, 0.08) 15px,
        rgba(255, 255, 255, 0.08) 16px
    );
    pointer-events: none;
    z-index: 1;
}

.unit-info { position: relative; z-index: 2; }
.unit-badge {
    background: var(--accent);
    color: #000;
    padding: 0.2rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    display: inline-block;
}

.mastery-ribbon {
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 2.5rem;
    color: var(--accent);
    z-index: 5;
    filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3));
}

.unit-dropdown {
    display: none;
    padding: 1.5rem;
    background: var(--card-bg);
    gap: 1rem;
    flex-wrap: wrap;
}
.unit-dropdown.active { display: flex; }

/* Overlays */
.overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: var(--bg);
    z-index: 1000;
    flex-direction: column;
}
.overlay-header {
    padding: 1rem 2rem;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--card-bg);
}
.overlay-body {
    flex: 1;
    overflow-y: auto;
    padding: 2rem;
    display: flex;
    justify-content: center;
}
.content-max { width: 100%; max-width: 800px; }

/* Flashcards */
.flashcard-stage { 
    perspective: 1000px; 
    height: 400px; 
    margin: 2rem 0; 
    position: relative;
}
.flashcard {
    width: 100%; height: 100%; position: absolute;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s;
    transform-style: preserve-3d; cursor: pointer;
}
.flashcard.flipped { transform: rotateY(180deg); }

.card-face {
    position: absolute; width: 100%; height: 100%; backface-visibility: hidden;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 3rem; border-radius: 32px; border: 2px solid var(--primary);
    background: var(--card-bg); text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.1);
}
.card-back { transform: rotateY(180deg); background: var(--bg); }

/* Quiz Styles */
.q-box { background: var(--card-bg); padding: 2rem; border-radius: 24px; border: 1px solid var(--border); }
.progress-container { height: 8px; background: var(--border); border-radius: 4px; margin: 1.5rem 0; overflow: hidden; }
.progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
.options-list { display: grid; gap: 1rem; margin-top: 2rem; }
.option-btn {
    padding: 1.2rem; border-radius: 16px; border: 2px solid var(--border);
    background: var(--card-bg); text-align: left; cursor: pointer; font-size: 1rem;
    font-weight: 500; color: var(--text); transition: 0.2s;
}
.option-btn:hover { border-color: var(--primary); background: var(--bg); }
.option-btn.selected { border-color: var(--primary); background: #10b98133; color: var(--primary); }

/* Review Grid & Dot Banner Icons */
.review-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 0.5rem; margin: 2rem 0; }
.dot {
    width: 40px; height: 40px; border-radius: 8px; border: 1px solid var(--border);
    display: flex; align-items: center; justify-content: center; font-size: 0.8rem;
    font-weight: 700; cursor: pointer;
    color: var(--text);
    position: relative;
}
.dot.answered { background: var(--primary); color: white; border: none; }
.dot.current { box-shadow: 0 0 0 3px var(--primary); }

/* The tiny yellow banner icon in the top-right of the dot */
.dot.starred::before {
    content: "\f024"; /* FontAwesome Flag icon for banner */
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    position: absolute;
    top: -5px;
    right: -5px;
    color: var(--accent);
    font-size: 0.7rem;
    background: var(--card-bg);
    border-radius: 50%;
    width: 14px;
    height: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.star-trigger { color: var(--text-light); cursor: pointer; font-size: 1.5rem; transition: 0.2s; }
.star-trigger.active { color: var(--accent); }

.status-pill { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; background: var(--border); color: var(--text); }

/* Animations */
.slide-center { transform: translateX(0); opacity: 1; z-index: 2; }
.slide-in-right { transform: translateX(100%); opacity: 0; z-index: 1; }
.slide-in-left { transform: translateX(-100%); opacity: 0; z-index: 1; }
.slide-out-left { transform: translateX(-100%); opacity: 0; }
.slide-out-right { transform: translateX(100%); opacity: 0; }

@media (max-width: 600px) {
    header { padding: 1rem; flex-wrap: wrap; gap: 10px; }
    .logo { order: 1; width: 100%; text-align: center; }
}
</style>
</head>
<body>

<header>
    <div class="header-tools">
        <a href="https://sites.google.com/view/money--mentor/home" class="btn btn-ghost"><i class="fas fa-chevron-left"></i> Home</a>
        <a href="https://sites.google.com/view/money--mentor/learn/videos?authuser=0" class="btn btn-ghost"><i class="fas fa-play-circle"></i> Videos</a>
    </div>
    <div class="logo">MONEY MENTOR</div>
    <div class="header-tools">
        <button id="theme-btn" class="btn btn-outline" style="padding: 0.6rem;"><i class="fas fa-sun"></i></button>
        <div class="status-pill" style="color: white; border: 1px solid rgba(255,255,255,0.3); background: transparent;">
            Unit Complete: <span id="unitsDone">0</span>/2
        </div>
    </div>
</header>

<div class="container">
    <div class="unit-grid" id="dashboard-grid"></div>
    <div style="text-align: center; margin-top: 3rem;">
        <button class="btn" style="color: var(--text-light);" onclick="clearAllData()">
            <i class="fas fa-trash-alt"></i> Reset All Progress
        </button>
    </div>
</div>

<div id="app-overlay" class="overlay">
    <div class="overlay-header">
        <button class="btn btn-ghost" style="color: var(--text)" onclick="closeOverlay()">
            <i class="fas fa-times"></i> Exit
        </button>
        <div id="overlay-title" style="font-weight: 700; color: var(--text)">Unit 1: Basic Investing Vocab</div>
        <div id="star-btn-container">
            <i class="fas fa-star star-trigger" id="global-star" onclick="handleStar()"></i>
        </div>
    </div>
    <div class="overlay-body">
        <div class="content-max" id="overlay-content"></div>
    </div>
</div>

<script>
const units = [
    {
        id: "unit1",
        title: "Basic Investing Vocab",
        icon: "fa-chart-line",
        data: [
            { term: "Stock", def: "A share of ownership in a company and potential profits.", q: "What is a 'stock'?", a: ["Share of ownership in a company", "Debt issued by a company", "A bank savings account", "A type of corporate bond"], c: 0 },
            { term: "Bond", def: "A loan to a company or government for interest.", q: "What is a 'bond'?", a: ["Share of ownership in a company", "Loan to a company or government", "An interest-bearing liquid account", "A type of insurance contract"], c: 1 },
            { term: "Asset", def: "Something valuable you own, either physical or financial.", q: "What is an 'asset'?", a: ["Debt you owe to a bank", "Potential future salary income", "Something valuable you own", "An unavoidable expense item"], c: 2 },
            { term: "Liability", def: "Obligations or debts owed to others.", q: "What is a 'liability'?", a: ["A company's total owned stock", "A shareholder dividend payment", "Debt or obligation you owe", "A financial resource of value"], c: 2 },
            { term: "Dividend", def: "Profits distributed to shareholders.", q: "What is a 'dividend'?", a: ["Company profits paid to shareholders", "Company profits kept for research", "Change in a stock's market price", "The interest paid on a corporate bond"], c: 0 },
            { term: "Capital", def: "Money allocated specifically for investment purposes.", q: "What is 'capital'?", a: ["Total company annual revenue", "Money used for investment", "The principal of a personal loan", "Total dividend earnings received"], c: 1 },
            { term: "Portfolio", def: "Your complete collection of financial investments.", q: "What is a 'portfolio'?", a: ["A single high-performing stock holding", "A traditional bank savings account", "A summary of outstanding debts", "Collection of all your investments"], c: 3 },
            { term: "Risk", def: "The chance that an investment‚Äôs actual return will differ from expected.", q: "What is 'risk' in investing?", a: ["The possibility of losing money", "A guaranteed investment return", "A fixed annual interest payment", "Steady company revenue growth"], c: 0 },
            { term: "Liquidity", def: "Indicates how quickly an asset can be converted to cash without losing value.", q: "What is 'liquidity'?", a: ["The overall profitability of an investment", "Current market demand for specific stocks", "Ease of converting an asset to cash", "The long-term potential of an investment"], c: 2 },
            { term: "Interest", def: "The cost of borrowing money, usually expressed as a percentage.", q: "What is 'interest'?", a: ["Profit made from selling a stock", "Payment for borrowing money", "The initial investment principal", "A specific dividend payout received"], c: 1 }
        ]
    },
    {
        id: "unit2",
        title: "Banking Basics",
        icon: "fa-piggy-bank",
        data: [
            { term: "APR", def: "The annual cost of borrowing money.", q: "What does APR stand for?", a: ["Annual Profit Rate", "Annual Percentage Rate", "Applied Payment Ratio", "Account Percent Real"], c: 1 },
            { term: "Compound Interest", def: "Interest earned on both principal and interest.", q: "Interest earned on both principal and interest is:", a: ["Simple Interest", "Compound Interest", "Flat Interest", "Fixed Interest"], c: 1 },
            { term: "Overdraft", def: "A fee for spending more than your balance.", q: "A fee for spending more than your balance is an:", a: ["Interest charge", "Overdraft fee", "Service fee", "Late fee"], c: 1 }
        ]
    }
];

// App State
let currentUnit = null;
let activeStudySet = [];
let currentIdx = 0;
let userAnswers = [];
let isStudyStarredMode = false;
let isQuizMode = false;

// Persistent Data
let scores = JSON.parse(localStorage.getItem('mm_scores') || '{}');
let starredTerms = JSON.parse(localStorage.getItem('mm_starred') || '[]'); 
let isAnimating = false;

function renderDashboard() {
    const grid = document.getElementById('dashboard-grid');
    grid.innerHTML = '';
    let completedCount = 0;

    units.forEach(unit => {
        const highScore = scores[unit.id] || 0;
        const mastered = highScore >= 90;
        if(mastered) completedCount++;
        
        const card = document.createElement('div');
        card.className = 'unit-card';
        card.onclick = () => toggleUnit(unit.id);
        
        const hasStars = unit.data.some(d => starredTerms.includes(d.term));

        card.innerHTML = `
            ${mastered ? '<div class="mastery-ribbon"><i class="fas fa-award"></i></div>' : ''}
            <div class="unit-card-hero">
                <div class="unit-info">
                    ${mastered ? '<span class="unit-badge">MASTERED</span>' : ''}
                    <h2 style="margin:0; font-family:Poppins;"><i class="fas ${unit.icon}"></i> ${unit.title}</h2>
                    <p style="margin:10px 0 0; opacity:0.9; font-size:0.9rem;">Best Score: ${highScore}%</p>
                </div>
            </div>
            <div class="unit-dropdown" id="drop-${unit.id}">
                <button class="btn btn-primary" onclick="openStudy('${unit.id}', event)" style="flex:1"><i class="fas fa-book-open"></i> Study All</button>
                <div class="btn-disabled-container" style="flex:1">
                    <button class="btn btn-outline" id="star-study-${unit.id}" onclick="openStudyStarred('${unit.id}', event)" 
                        style="width: 100%; border-color:var(--accent); color:var(--accent); ${!hasStars ? 'opacity:0.5; cursor:help;' : ''}">
                        <i class="fas fa-star"></i> Studied Starred Terms
                    </button>
                    ${!hasStars ? '<span class="tooltip-text">You don‚Äôt have any starred terms yet.</span>' : ''}
                </div>
                <button class="btn btn-primary" onclick="openQuiz('${unit.id}', event)" style="flex:1; background:var(--secondary)"><i class="fas fa-clipboard"></i> Test</button>
            </div>
        `;
        grid.appendChild(card);
    });
    document.getElementById('unitsDone').innerText = completedCount;
}

function toggleUnit(id) {
    document.querySelectorAll('.unit-dropdown').forEach(d => {
        if(d.id !== `drop-${id}`) d.classList.remove('active');
    });
    const drop = document.getElementById(`drop-${id}`);
    if(drop) drop.classList.toggle('active');
}

function openStudy(unitId, event) {
    if(event) event.stopPropagation();
    currentUnit = units.find(u => u.id === unitId);
    activeStudySet = [...currentUnit.data];
    isStudyStarredMode = false;
    isQuizMode = false;
    currentIdx = 0;
    launchStudyUI();
}

function openStudyStarred(unitId, event) {
    if(event) event.stopPropagation();
    currentUnit = units.find(u => u.id === unitId);
    activeStudySet = currentUnit.data.filter(d => starredTerms.includes(d.term));
    if(activeStudySet.length === 0) return;
    isStudyStarredMode = true;
    isQuizMode = false;
    currentIdx = 0;
    launchStudyUI();
}

function launchStudyUI() {
    document.getElementById('app-overlay').style.display = 'flex';
    document.getElementById('overlay-title').innerText = `${currentUnit.title} | ${isStudyStarredMode ? 'Studied Starred Terms' : 'Flashcards'}`;
    const starIcon = document.getElementById('global-star');
    starIcon.className = "fas fa-star star-trigger"; // Use Star for study
    
    const content = document.getElementById('overlay-content');
    content.innerHTML = `
        <div style="text-align:center; color:var(--text-light); margin-bottom:1rem;" id="card-counter">Card 1 of ${activeStudySet.length}</div>
        <div class="flashcard-stage" id="stage">
            <div class="flashcard slide-center" id="card-obj" onclick="this.classList.toggle('flipped')"></div>
        </div>
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <button class="btn btn-outline" style="color:var(--text); border-color:var(--border)" onclick="moveCard(-1)"><i class="fas fa-arrow-left"></i></button>
            <div class="status-pill">Tap card to flip</div>
            <button class="btn btn-outline" style="color:var(--text); border-color:var(--border)" onclick="moveCard(1)"><i class="fas fa-arrow-right"></i></button>
        </div>
    `;
    updateFlashcardContent(document.getElementById('card-obj'), activeStudySet[0]);
}

function updateFlashcardContent(cardEl, data) {
    updateStarState(data.term);
    cardEl.innerHTML = `
        <div class="card-face">
            <div style="font-size: 2.5rem; font-weight: 800; color: var(--primary);">${data.term}</div>
            <div style="margin-top: 2rem; font-size: 0.8rem; opacity: 0.6; color: var(--text-light)">TAP TO REVEAL DEFINITION</div>
        </div>
        <div class="card-face card-back">
            <div style="font-size: 0.9rem; font-weight: 700; color: var(--primary); margin-bottom: 1rem;">DEFINITION</div>
            <div style="font-size: 1.4rem; line-height: 1.6; color: var(--text)">${data.def}</div>
        </div>
    `;
}

function moveCard(step) {
    if(isAnimating) return;
    let nextIdx = currentIdx + step;
    if(nextIdx < 0 || nextIdx >= activeStudySet.length) return;
    isAnimating = true;
    const oldCard = document.getElementById('card-obj');
    const stage = document.getElementById('stage');
    const newCard = document.createElement('div');
    newCard.className = `flashcard ${step > 0 ? 'slide-in-right' : 'slide-in-left'}`;
    newCard.onclick = function() { this.classList.toggle('flipped'); };
    updateFlashcardContent(newCard, activeStudySet[nextIdx]);
    stage.appendChild(newCard);
    newCard.offsetHeight;
    oldCard.classList.add(step > 0 ? 'slide-out-left' : 'slide-out-right');
    newCard.classList.remove('slide-in-right', 'slide-in-left');
    newCard.classList.add('slide-center');
    currentIdx = nextIdx;
    document.getElementById('card-counter').innerText = `Card ${currentIdx + 1} of ${activeStudySet.length}`;
    setTimeout(() => { oldCard.remove(); newCard.id = 'card-obj'; isAnimating = false; }, 600);
}

function openQuiz(unitId, event) {
    event.stopPropagation();
    currentUnit = units.find(u => u.id === unitId);
    activeStudySet = [...currentUnit.data];
    userAnswers = new Array(activeStudySet.length).fill(null);
    currentIdx = 0;
    isQuizMode = true;
    document.getElementById('app-overlay').style.display = 'flex';
    renderQuizStart();
}

function renderQuizStart() {
    document.getElementById('overlay-title').innerText = `${currentUnit.title} | Test`;
    document.getElementById('star-btn-container').style.visibility = 'hidden';
    document.getElementById('overlay-content').innerHTML = `
        <div class="q-box" style="text-align:center; padding: 4rem 2rem;">
            <div style="font-size: 4rem; margin-bottom: 1.5rem;"><i class="fas fa-clipboard-check" style="color:var(--primary)"></i></div>
            <h1 style="font-family:Poppins; color:var(--text)">Ready for the test?</h1>
            <p style="color:var(--text-light); margin-bottom: 2rem;">Aim for 90% to master this unit.</p>
            <button class="btn btn-primary" style="width:100%; padding: 1.2rem;" onclick="startQuiz()">Begin Assessment</button>
        </div>
    `;
}

function startQuiz() {
    document.getElementById('star-btn-container').style.visibility = 'visible';
    const starIcon = document.getElementById('global-star');
    starIcon.className = "fas fa-flag star-trigger"; // Use Flag for test banner
    renderQuestion();
}

function renderQuestion() {
    const item = activeStudySet[currentIdx];
    const progress = ((currentIdx + 1) / activeStudySet.length) * 100;
    updateStarState(item.term);
    let optionsHtml = item.a.map((opt, i) => `
        <button class="option-btn ${userAnswers[currentIdx] === i ? 'selected' : ''}" onclick="selectOption(${i})">${opt}</button>
    `).join('');
    let dotsHtml = userAnswers.map((ans, i) => {
        let cls = i === currentIdx ? 'current' : '';
        if(ans !== null) cls += ' answered';
        if(starredTerms.includes(activeStudySet[i].term)) cls += ' starred';
        return `<div class="dot ${cls}" onclick="jumpTo(${i})">${i+1}</div>`;
    }).join('');
    document.getElementById('overlay-content').innerHTML = `
        <div class="q-box">
            <span class="status-pill">Question ${currentIdx + 1} of ${activeStudySet.length}</span>
            <div class="progress-container"><div class="progress-bar" style="width:${progress}%"></div></div>
            <h2 style="margin: 1.5rem 0; font-size: 1.4rem; color:var(--text)">${item.q}</h2>
            <div class="options-list">${optionsHtml}</div>
            <div class="review-grid">${dotsHtml}</div>
            <div style="display:flex; justify-content:space-between; margin-top:2rem;">
                <button class="btn btn-outline" style="color:var(--text); border-color:var(--border)" onclick="prevQ()"><i class="fas fa-chevron-left"></i> Back</button>
                <button class="btn btn-primary" onclick="nextQ()">${currentIdx === activeStudySet.length - 1 ? 'Finish' : 'Next'}</button>
            </div>
        </div>
    `;
}

function selectOption(idx) { userAnswers[currentIdx] = idx; renderQuestion(); }
function nextQ() { if(currentIdx < activeStudySet.length - 1) { currentIdx++; renderQuestion(); } else { finishQuiz(); } }
function prevQ() { if(currentIdx > 0) { currentIdx--; renderQuestion(); } }
function jumpTo(idx) { currentIdx = idx; renderQuestion(); }

function finishQuiz() {
    let correct = 0;
    activeStudySet.forEach((item, i) => { if(userAnswers[i] === item.c) correct++; });
    const score = Math.round((correct / activeStudySet.length) * 100);
    if(!scores[currentUnit.id] || score > scores[currentUnit.id]) {
        scores[currentUnit.id] = score;
        localStorage.setItem('mm_scores', JSON.stringify(scores));
    }
    renderResults(score, correct);
}

function renderResults(score, correct) {
    document.getElementById('star-btn-container').style.visibility = 'hidden';
    let breakdown = activeStudySet.map((item, i) => `
        <div style="display:flex; align-items:center; justify-content:space-between; padding:10px 0; border-bottom:1px solid var(--border)">
            <div>
                <div style="font-weight:600; color:var(--text)">${item.term}</div>
                <div style="font-size:0.8rem; color:var(--text-light)">${item.q}</div>
            </div>
            <div style="color: ${userAnswers[i] === item.c ? 'var(--primary)' : 'var(--danger)'}">
                <i class="fas ${userAnswers[i] === item.c ? 'fa-check-circle' : 'fa-times-circle'}"></i>
            </div>
        </div>
    `).join('');
    document.getElementById('overlay-content').innerHTML = `
        <div class="q-box" style="text-align:center;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">${score >= 90 ? 'üèÜ' : 'ü•à'}</div>
            <h1 style="margin:0; color:var(--text)">${score}%</h1>
            <p style="color:var(--text-light); margin-bottom: 2rem;">You got ${correct} out of ${activeStudySet.length} correct!</p>
            <div style="text-align:left; border-top: 1px solid var(--border); padding-top: 1rem;">
                <h4 style="margin-bottom:1rem; color:var(--text)">Review</h4>
                ${breakdown}
            </div>
            <button class="btn btn-primary" style="width:100%; margin-top:2rem;" onclick="closeOverlay()">Dashboard</button>
        </div>
    `;
    renderDashboard();
}

function handleStar() {
    const term = activeStudySet[currentIdx].term;
    if(starredTerms.includes(term)) {
        starredTerms = starredTerms.filter(t => t !== term);
    } else {
        starredTerms.push(term);
    }
    // Save to persistence
    localStorage.setItem('mm_starred', JSON.stringify(starredTerms));
    updateStarState(term);
    if(document.querySelector('.review-grid')) renderQuestion();
}

function updateStarState(term) {
    const btn = document.getElementById('global-star');
    if(!btn) return;
    if(starredTerms.includes(term)) btn.classList.add('active');
    else btn.classList.remove('active');
}

function closeOverlay() { 
    document.getElementById('app-overlay').style.display = 'none'; 
    isQuizMode = false;
    renderDashboard(); 
}

function clearAllData() {
    if(confirm("Reset all progress?")) {
        localStorage.removeItem('mm_scores');
        localStorage.removeItem('mm_starred');
        scores = {}; starredTerms = []; renderDashboard();
    }
}

document.getElementById('theme-btn').onclick = () => {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
    document.getElementById('theme-btn').innerHTML = isDark ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
};

window.onload = renderDashboard;
</script>
</body>
</html>
